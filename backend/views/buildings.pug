extends layout.pug

mixin filterBlock 
  p Search by keyword
  form.d-flex.my-auto(action='/search', method='get')
    input.form-control.me-sm-2(type='search', name='query', placeholder='Search')
    button.btn.btn-secondary.my-2.my-sm-0(type='submit') 
      i.fas.fa-arrow-right
  hr
  p View buildings in a specific year
  form.d-flex(action='/buildings/existingInYear', method='get')
    input.form-control.me-sm-2(type='number', name='query', placeholder='Year', max=currentYear)
    button.btn.btn-secondary.my-2.my-sm-0(type='submit') 
      i.fas.fa-arrow-right
  hr
  p View buildings built between 
  form.d-flex(action='/buildings/builtBetween', method='get')
    input.form-control.me-sm-2(type='number', required, name='startYear', placeholder='Start', max=currentYear)
    input.form-control.me-sm-2(type='number', required, name='endYear', placeholder='End', max=currentYear)
    button.btn.btn-secondary.my-2.my-sm-0(type='submit') 
      i.fas.fa-arrow-right
  hr
  p View buildings destroyed between
  form.d-flex(action='/buildings/destroyedBetween', method='get')
    input.form-control.me-sm-2(type='number', required, name='startYear', placeholder='Start', max=currentYear)
    input.form-control.me-sm-2(type='number', required, name='endYear', placeholder='End', max=currentYear)
    button.btn.btn-secondary.my-2.my-sm-0(type='submit') 
      i.fas.fa-arrow-right
  hr
  - url = "/buildings/existingInYear?query=" + currentYear
  a(href=url) Show buildings in the current year

  if message 
    hr
    a(href="/buildings") Clear filters

block content
  script. 
    document.addEventListener("DOMContentLoaded", () => { 
      let showFilters = true;
      const button  = document.getElementById('toggleButton');
      const h5 = button.querySelector('h5');
      button.addEventListener("click", function(event) {
        h5.innerText = h5.textContent !== "Hide filters" ? "Hide filters" : "Show filters";
      })
    });
  style.
    .onlyOnMobile {
      display: none;
    }
    @media screen and (max-width: 992px) {
      .hideOnMobile {
        display: none;
      }
      .onlyOnMobile {
        display: inline-block;
      }
      th, 
      td {
        padding: 1rem !important;
      }
      table * {
        font-size: 1rem !important;
      }
    }
  - var currentYear = (new Date()).getFullYear()
  - var url

  .mx-4.my-lg-4
    .row
      nav.navbar.onlyOnMobile.my-2
        .container-fluid
          button.navbar-toggler(id='toggleButton', style="border: none", type='button', data-bs-toggle='collapse', data-bs-target='#searchbar', aria-controls='searchbar', aria-expanded='false', aria-label='Toggle navigation')
            span.fas.fa-filter
            - var filterMessage = showFilters ? "Hide filters" : "Show filters"
            h5#filterMessage.d-inline.ms-3 #{filterMessage}
          #searchbar.collapse.navbar-collapse
            .pt-4.px-4
              +filterBlock
              hr.mb-5
              
      .col-12.mb-5.col-lg-3.mb-lg-0.hideOnMobile
        .border
          .p-3
            +filterBlock

      .col-12.col-lg-9(style="max-width: 100%; overflow-x: auto; margin: 0 auto;")
        if message 
          h4 #{message}
        else if secondQuery
          h4 Viewing buildings standing in #{secondQuery}
        else 
          h4 Viewing all buildings
        table.table.table-hover
          thead
            tr
              th(scope='col').col-5.col-lg-3
                a.nav-link.dropdown-toggle(data-bs-toggle='dropdown' href='#' role='button' aria-haspopup='true' aria-expanded='false') Name
                .dropdown-menu
                  - url = previousFilter ? "/buildings/sortedByName/a-z/" + previousFilter : "/buildings/sortedByName/a-z/"
                  a.dropdown-item(href=url) A-Z
                  - url = previousFilter ? "/buildings/sortedByName/z-a/" + previousFilter : "/buildings/sortedByName/z-a/"
                  a.dropdown-item(href=url) Z-A
              th(scope='col').col-1
                a.nav-link.dropdown-toggle(data-bs-toggle='dropdown' href='#' role='button' aria-haspopup='true' aria-expanded='false') Built
                .dropdown-menu
                  - url = previousFilter ? "/buildings/sortedByYearBuilt/most-recent/" + previousFilter : "/buildings/sortedByYearBuilt/most-recent/"
                  a.dropdown-item(href=url) Most Recent
                  - url = previousFilter ? "/buildings/sortedByYearBuilt/oldest/" + previousFilter : "/buildings/sortedByYearBuilt/oldest/"
                  a.dropdown-item(href=url) Oldest
              th(scope='col').col-1
                a.nav-link.dropdown-toggle(data-bs-toggle='dropdown' href='#' role='button' aria-haspopup='true' aria-expanded='false') 
                  span.hideOnMobile Destroyed
                  span.onlyOnMobile Dest.
                .dropdown-menu
                  - url = previousFilter ? "/buildings/sortedByYearDestroyed/most-recent/" + previousFilter : "/buildings/sortedByYearDestroyed/most-recent/"
                  a.dropdown-item(href=url) Most Recent
                  - url = previousFilter ? "/buildings/sortedByYearDestroyed/oldest/" + previousFilter : "/buildings/sortedByYearDestroyed/most-recent/"
                  a.dropdown-item(href=url) Oldest
              th(scope='col').col-5.col-lg-3 Address
              th(scope='col').col-lg-4.hideOnMobile Address Description
          each building in buildings 
            - var url = '/profile/' + building.name
            tr.table-secondary
              th(scope='row') 
                a(href=url) #{building.name}
              td #{building.year_built}
              td #{building.year_destroyed}
              td #{building.address}
              td.hideOnMobile #{building.address_description}
